<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<title>JS Example for Guild Scrape</title>

<style>
label {
	display: block;
	margin: 0 0 5px;
	font-weight: bold;
}

input {
	width: 350px;
	padding: 5px;
	border: 1px solid #ddd;
	border-radius: 2px;
}

button {
	display: inline-block;
	margin: 5px 0;
	padding: 10px 30px;
	background: #efefef;
	border: 1px solid #ddd;
	border-radius: 2px;
}
</style>

</head>
<body>

<label for="page-url">URL for Guild Page:</label>
<input type="text" id="page-url"><br>
<button type="button" id="submit-button">Get Player Data</button>

<p>Example Guild URLs:</p>
<ul>
	<li>/19528/gid-liquid-schwartz/</li>
	<li>/21284/gid-1-800-druidia/</li>
</ul>

<div id="results"></div>

<script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>

function setListener() {
	$( '#submit-button' ).on( 'click', handleClick );
}

function handleClick( event ) {
	event.preventDefault();

	clearResults();
	drawResults();
}

function clearResults() {
	$( '#results' ).empty();
}

function drawResults() {
	var pageUrl = $( '#page-url' ).val();

	$.ajax({
		url: 'guild_members.php',
		data: {
			url: encodeURIComponent( pageUrl )
		},
		dataType: 'json'
	}).done( function( resp ) {
		console.log( resp );

		var resultsString = resp.reduce( function( accum, current ) {
			var returnString = '<li>';
			returnString += 'Name: ' + current.name + '<br>';
			returnString += 'GP: ' + current.gp + '<br>';
			returnString += 'Collection Score: ' + current.collection_score + '<br>';
			returnString += 'Arena Average: ' + current.arena_average + '<br>';
			returnString += '</li>';

			return accum + returnString;
		}, '' );

		$( '#results' ).html( '<ul>' + resultsString + '</ul>' );
	});
}

void function() {
	setListener();
}();

</script>
	
</body>
</html>